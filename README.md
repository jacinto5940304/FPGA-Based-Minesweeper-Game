# 蹦蹦炸彈 (FPGA 踩地雷遊戲)

## 專案簡介
本專案為《CS21040 硬體設計實驗》課程最終專題。  
我們以童年經典遊戲「踩地雷」為靈感，結合 FPGA 板的硬體設計，設計並實作了一個以鍵盤、VGA、7-segment、LED 為主要互動介面的踩地雷系統。

本遊戲包含三種模式：
- **普通模式（Normal Mode）**：自動隨機生成地雷地圖，完成清除所有安全格子。
- **沙盒模式（Sandbox Mode）**：玩家自行設置地雷位置後進行遊戲（部分功能未完成）。
- **除錯模式（Debug Mode）**：可偷看地雷分佈以協助測試。

---

## 硬體設計與使用裝置
- **VGA**：顯示踩地雷的遊戲畫面。
- **Keyboard**：32個鍵對應遊戲格子，搭配 L-Shift 可進行插旗操作。
- **LED**：顯示當前模式與地雷踩中後的爆炸特效。
- **7-segment**：顯示剩餘地雷數量與倒數時間。
- **Switch/Button**：選擇遊戲模式與進行除錯功能。

---

## 遊戲規則
- 每場地圖最多隨機放置 **10 顆地雷**。
- 玩家必須在 **99 秒內找出所有安全格子**。
- 插旗數量將同步更新在七段顯示器上。
- **第一次挖地不會直接踩雷**（自動展開安全區域）。
- 地圖提示數字超過4顆時，以特殊「**芋頭**」圖案顯示（小彩蛋）。

---

## 操作方式
- **sw0 / btnU**：選擇普通模式、沙盒模式、除錯模式。
- **鍵盤按鍵**：選取格子進行挖掘；搭配 L-Shift 插旗。
- **sw15**：除錯模式開啟，可以偷看底圖。

---

## 系統架構
- 以 **FSM（Finite State Machine）** 設計遊戲流程，包括 IDLE、NORMAL、SAND、WIN、LOSS 五大狀態。
- 地圖資料結構分為 `def_map`（底圖）與 `is_flag_or_flip`（玩家視圖），以同步更新與管理地圖狀態。
- 地雷隨機生成採用 **counter 擾動計算**，確保每次分佈不同。
- 地雷周圍提示數量自動計算，實作 **連鎖展開空白區域** 功能。
- VGA 以低解析度 (80×60) 顯示，減少記憶體使用壓力。
- 七段顯示器與 LED 動畫提供視覺回饋。

---

## 完成情況
✅ 普通模式完整實作  
✅ 地雷隨機生成與提示數字產生  
✅ 連鎖展開非地雷格子  
✅ LED、7-segment 效果  
✅ VGA 顯示介面與勝利、失敗畫面特效  
🛠 沙盒模式地雷設置功能部分完成（小bug：切換後底圖回到隨機模式）

---

## 開發技術亮點
- VGA 顯示優化（壓縮圖片資源至一維陣列）
- Shift+Key 插旗功能實作
- 多層地圖資料結構同步
- 自動生成地雷提示與區域展開演算法
- 以 counter 擾動方式產生隨機地雷分佈

---

## 遇到的挑戰與解決
- **VGA 顯示錯誤**：調整 h_cnt, v_cnt 計算方式後成功正確顯示。
- **地圖爆破錯誤**：搬移地雷數量計算至 STATE_IDLE 避免累加溢位。
- **沙盒模式失敗**：雖然能記錄玩家佈置，但切換狀態時底圖未成功保留（持續debug未果）。
- **記憶體資源壓力**：優化圖片資料格式與地圖結構降低資源佔用。

---

## 分工
- **李晉方**：隨機地雷生成、鍵盤操作（插旗）、地雷連環爆設計。
- **楊承霖**：LED 跑馬燈、狀態機設計、7-segment 操作、地雷提示自動生成。
- **共同**：VGA 畫面設計、基礎 map init、沙盒模式初步架構、除錯除錯再除錯。
